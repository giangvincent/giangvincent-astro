---
import PixelLayout from "../components/pixel/PixelLayout.astro";
import PixelSection from "../components/pixel/PixelSection.astro";
import PixelCard from "../components/pixel/PixelCard.astro";
import PixelContactTrigger from "../components/pixel/PixelContactTrigger.astro";
import { SITE_DESCRIPTION, SITE_TITLE } from "../consts";
import { fetchAboutContent, fetchHomepageContent } from "../lib/contentApi";

const aboutContent = await fetchAboutContent("default");
const homepageContent = await fetchHomepageContent();

const navItems = [
  { id: "intro", label: "Intro" },
  { id: "portfolios", label: "Portfolios" },
  { id: "services", label: "Services" },
  { id: "blogs", label: "Blogs" },
];

const topPortfolios = homepageContent.portfolios.slice(0, 4);
const topServices = homepageContent.services.slice(0, 4);
const topBlogs = homepageContent.blogs.slice(0, 4);
---

<PixelLayout
  pageTitle={SITE_TITLE}
  description={SITE_DESCRIPTION}
  navItems={navItems}
  sidebarIntro="Your Vision. Our Lab. Letâ€™s Build.">
  <PixelSection id="intro" label="Intro" title={aboutContent.title}>
    <div class="pixel-intro-grid">
      <div class="pixel-intro-body">
        <div set:html={aboutContent.body}></div>
        {
          aboutContent.skills.length > 0 && (
            <div>
              <p>
                <strong>Skills radar</strong>
              </p>
              <ul class="pixel-tag-list">
                {aboutContent.skills.map((skill) => (
                  <li class="pixel-tag">{skill}</li>
                ))}
              </ul>
            </div>
          )
        }
      </div>
    </div>
    <div class="pixel-card-tags" style="margin-top:1.5rem;">
      <PixelContactTrigger label="Initiate a Lab Session" source="Homepage" />
      <a class="pixel-cta" href="/about">Detail about me</a>
    </div>
  </PixelSection>

  <PixelSection
    id="portfolios"
    label="Lab Drop"
    title="Portfolios"
    description="Latest launches and experiments from the GV lab."
    footerHref="/portfolio"
    footerLabel="Browse Lab Experiments">
    <div class="pixel-card-grid">
      {
        topPortfolios.length > 0 ? (
          topPortfolios.map((card) => (
            <PixelCard
              title={card.title}
              description={card.description}
              href={card.href}
              coverImageUrl={card.coverImageUrl}
              tags={card.tags}
            />
          ))
        ) : (
          <div class="pixel-empty-state">
            No transmissions yet. Check back soon.
          </div>
        )
      }
    </div>
  </PixelSection>

  <PixelSection
    id="services"
    label="Capabilities"
    title="Services"
    description="Delivery menu for product, platform, and growth work."
    footerHref="/services"
    footerLabel="Enter the Service Vault">
    <div class="pixel-card-grid">
      {
        topServices.length > 0 ? (
          topServices.map((card) => (
            <PixelCard
              title={card.title}
              description={card.description}
              href={card.href}
              coverImageUrl={card.coverImageUrl}
            />
          ))
        ) : (
          <div class="pixel-empty-state">No services published yet.</div>
        )
      }
    </div>
  </PixelSection>

  <PixelSection
    id="blogs"
    label="Logs"
    title="Blogs"
    description="Fresh notes, tutorials, and behind-the-scenes logs."
    footerHref="/blog"
    footerLabel="Open Research Logs">
    <div class="pixel-card-grid">
      {
        topBlogs.length > 0 ? (
          topBlogs.map((card) => (
            <PixelCard
              title={card.title}
              description={card.description}
              href={card.href}
              coverImageUrl={card.coverImageUrl}
            />
          ))
        ) : (
          <div class="pixel-empty-state">No logs yet. Stay tuned.</div>
        )
      }
    </div>
  </PixelSection>
</PixelLayout>
