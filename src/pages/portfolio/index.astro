---
import PixelLayout from '../../components/pixel/PixelLayout.astro';
import PixelSection from '../../components/pixel/PixelSection.astro';
import PixelCard from '../../components/pixel/PixelCard.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../../consts';
import { fetchPortfolioProjects, sortProjectsForListing } from '../../lib/portfolioApi';

const projects = sortProjectsForListing(await fetchPortfolioProjects());
const featured = projects.filter((project) => project.isFeatured);
const others = projects.filter((project) => !project.isFeatured);

const navItems = (
	[
		featured.length > 0 ? { id: 'featured', label: 'Featured' } : null,
		{ id: 'all-projects', label: 'All Projects' },
	] as Array<{ id: string; label: string } | null>
).filter(Boolean) as Array<{ id: string; label: string }>;
---

<PixelLayout
	pageTitle={`Portfolio | ${SITE_TITLE}`}
	description={SITE_DESCRIPTION}
	navItems={navItems}
	sidebarIntro="Browse featured case studies or jump straight into the full index."
>
	{
		featured.length > 0 && (
			<PixelSection
				id="featured"
				label="Spotlight"
				title="Featured launches"
				description="A handful of flagship builds leading the roadmap."
			>
				<div class="pixel-card-grid">
					{
						featured.map((project) => (
							<PixelCard
								title={project.title}
								description={project.summary}
								href={`/portfolio/${project.slug}/`}
								coverImageUrl={project.thumbnailUrl ?? project.heroImageUrl}
								tags={project.tags}
							/>
						))
					}
				</div>
			</PixelSection>
		)
	}

	<PixelSection
		id="all-projects"
		label="Archive"
		title="All projects"
		description="Every build, experiment, and shipping log."
	>
		<div class="pixel-card-grid">
			{
				others.length > 0 ? (
					others.map((project) => (
						<PixelCard
							title={project.title}
							description={project.summary}
							href={`/portfolio/${project.slug}/`}
							coverImageUrl={project.thumbnailUrl ?? project.heroImageUrl}
							tags={project.tags}
						/>
					))
				) : (
					<div class="pixel-empty-state">
						No additional projects yet. Featured work will spill over here soon.
					</div>
				)
			}
		</div>
	</PixelSection>
</PixelLayout>
