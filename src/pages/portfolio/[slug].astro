---
import FormattedDate from '../../components/FormattedDate.astro';
import PixelLayout from '../../components/pixel/PixelLayout.astro';
import PixelSection from '../../components/pixel/PixelSection.astro';
import '../../styles/pixel-theme.css';
import { fetchPortfolioProjects, type PortfolioProject } from '../../lib/portfolioApi';

export async function getStaticPaths() {
	const projects = await fetchPortfolioProjects();
	return projects.map((project) => ({
		params: { slug: project.slug },
		props: { project },
	}));
}

type Props = {
	project: PortfolioProject;
};

const { project } = Astro.props as Props;

const navItems = [
	{ id: 'overview', label: 'Overview' },
	{ id: 'case-study', label: 'Case Study' },
];
---

<PixelLayout
	pageTitle={`${project.title} | Portfolio`}
	description={project.summary || project.tagline || project.title}
	navItems={navItems}
	sidebarIntro="Explore the overview or jump straight into the build log."
>
	<PixelSection
		id="overview"
		label="Mission Brief"
		title={project.title}
		description={project.tagline}
	>
		<div class="pixel-hero">
			{
				project.heroImageUrl && (
					<img src={project.heroImageUrl} alt={project.title} loading="lazy" width="1280" height="640" />
				)
			}
			<div class="pixel-meta-grid">
				<div>
					<div class="pixel-meta-title">Launched</div>
					<FormattedDate date={project.publishedAt} />
				</div>
				{
					project.projectUrl && (
						<div>
							<div class="pixel-meta-title">Live URL</div>
							<a class="pixel-cta" href={project.projectUrl} target="_blank" rel="noreferrer">
								Visit Project
							</a>
						</div>
					)
				}
				{
					project.sourceUrl && (
						<div>
							<div class="pixel-meta-title">Source</div>
							<a class="pixel-cta" href={project.sourceUrl} target="_blank" rel="noreferrer">
								View Source
							</a>
						</div>
					)
				}
			</div>
			{
				project.tags.length > 0 && (
					<ul class="pixel-tag-list">
						{
							project.tags.map((tag) => (
								<li class="pixel-tag">{tag}</li>
							))
						}
					</ul>
				)
			}
		</div>
	</PixelSection>

	<PixelSection
		id="case-study"
		label="Build Log"
		title="Case study"
		description="Notes from the trenchesâ€”goals, obstacles, and shipping moments."
	>
		<div class="pixel-article-body" set:html={project.body}></div>
	</PixelSection>
</PixelLayout>
